<%- include ("../../partials/head.ejs") %>

        <div class="custom-fullheight">
                <div class="d-lg-flex min-h-full">
                        <%- include ("../../partials/admin-side-menu.ejs",{activeLink:20}) %>
                                <div class="w-100 superadmin-rightsection p-5 mob-p">
                                        <div class="color-000 pagename opensans-bold mb-4">
                                                <a class="pointer" href="../hospital"><img src="/static/img/back.png"
                                                                class="img-fluid">
                                                        Edit Hospital</a>
                                        </div>
                                        <div class="row">
                                                <div class="col-xxl-5 col-xl-12  col-lg-12 col-md-12 col-sm-12">
                                                        <div class="input-boxs">
                                                                <div class="row bor-bottom-line p-5">
                                                                        <div
                                                                                class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-6 col-xxl-12 mb-4 mb-lg-0">
                                                                                
                                                                                <div class="mb-4">
                                                                                        <label
                                                                                                class="color-333 superadmin-label">
                                                                                                Enter Hospital Name
                                                                                        </label>
                                                                                        <div class="">
                                                                                                <input type="text"
                                                                                                        class="form-control superadmin-formcontrol-input-1 rounded"
                                                                                                        id="hospital"
                                                                                                        value="<%= hospitalDetails.hospital_name %>"
                                                                                                        placeholder="Enter hospital name">
                                                                                        </div>
                                                                                </div>

                                                                               
                                                                                <div class="mb-4">
                                                                                    <label class="color-333 superadmin-label">
                                                                                        Select district
                                                                                    </label>
                                                                                    <div class="">
                                                                                        <select id="district" class="form-control superadmin-formcontrol-input-1 rounded">
                                                                                            <option value="">---select---</option>

                                                                                            <% for (var i = 0; i < districtList.length; i++){ %>
                                                                                         <option class="form-control" value="<%= districtList[i].district_id; %>" <%= districtList[i].district_id == hospitalDetails.district ? 'selected':"" %>>
                                                                                                <%= districtList[i].district;%> </option>
                                                                                            <% }%>
                                                                                        </select>
                                                                                    </div>
                                                                                </div>
                                                                                        
                                                                                <div class="mb-4">
                                                                                        <label
                                                                                                class="color-333 superadmin-label">
                                                                                                Enter  hospital Address
                                                                                        </label>
                                                                                        <div class="">
                                                                                                <input type="text"
                                                                                                        class="form-control superadmin-formcontrol-input-1 rounded"
                                                                                                        id="address"
                                                                                                        value="<%= hospitalDetails.address %>"
                                                                                                        placeholder="Enter address">
                                                                                        </div>
                                                                                    </div>
                                                                                      </div>
                                                                                    <div
                                                                                    class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-6 col-xxl-12 mb-4 mb-lg-0">
                                                                                    

                                                                                <label
                                                                                        class="color-333 superadmin-label">
                                                                                         Upload Hospital logo
                                                                                </label>
                                                                                    <div
                                                                                        class="position-relative upload-files-hospital mb-4 col-12">

                                                                                        <input type="file"
                                                                                                id="file-upload">
                                                                                        <div
                                                                                                class="upload-files-placeholder">
                                                                                                <img src="/static/img/upload.png"
                                                                                                        class="img-fluid">
                                                                                                
                                                                                        </div>
                                                                                        
                                                                                    </div>
                                                                                    <div class="row mx-0 "
                                                                                    id="files-wrapper">
                                                                                    <img src="/static/<%= hospitalDetails.logo; %>"
                                                                                            style="width: 200px;height: 200px;">
                                                                                </div>
                                                                                        </div>
                                                                                        </div>

                                                                                  


                                                                                 <div class="p-5">
                                                                                    <div class="color-000 pagename opensans-bold mb-4">
                                                                                        <u> Biller Details</u> 
                                                                                    </div>

                                                                                    <div class="mb-4">
                                                                                        <label
                                                                                                class="color-333 superadmin-label">
                                                                                                Enter  Biller Name
                                                                                        </label>
                                                                                        <div class="">
                                                                                                <input type="text"
                                                                                                        class="form-control superadmin-formcontrol-edit rounded"
                                                                                                        id="biller_name"
                                                                                                        value="<%= hospitalDetails.biller_name %>"
                                                                                                        placeholder="Enter biller name">
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="mb-4">
                                                                                        <label
                                                                                                class="color-333 superadmin-label">
                                                                                                Enter  Biller Email Id
                                                                                        </label>
                                                                                        <div class="">
                                                                                                <input type="text"
                                                                                                        class="form-control superadmin-formcontrol-edit rounded"
                                                                                                        id="email_id"
                                                                                                        value="<%= hospitalDetails.biller_email_id %>"
                                                                                                        placeholder="Enter Biller EmailId">
                                                                                        </div>
                                                                                    </div>

                                                                                    <div class="mb-4">
                                                                                        <label
                                                                                                class="color-333 superadmin-label">
                                                                                                Enter Biller contact number
                                                                                        </label>
                                                                                        <div class="">
                                                                                                <input type="text"
                                                                                                        class="form-control superadmin-formcontrol-edit rounded"
                                                                                                        id="contact_number"
                                                                                                        value="<%= hospitalDetails.contact_number %>"
                                                                                                        placeholder="Enter biller contact number">
                                                                                        </div>
                                                                                    </div>
          





                                                                                <div class="text-right mt-3 mb-3">
                                                                                        <button type="button"
                                                                                                class="btn-update-distributer mb-5 "
                                                                                                id="savedata">update</button>
                                                                                </div>
                                                                        </div>

                                                                        </div>
                                                                </div>
                                                        </div>
                                                </div>
                                        </div>
                                </div>

                </div>
        </div>

        <script>
                $(document).ready(function () {
                        mediaFiles = [];
                        const mediaFilesacceptedExtensions = ["jpg", "png", "jpeg"];
                        $("body").on("click", "#savedata", function () {

                                let hospitalElement = $("#hospital");
                                let hospital = hospitalElement.val();
                                hospital = $.trim(hospital);
                                if (hospital == "" || hospital == null || hospital == undefined) {
                                        messageDisplay("Please Enter hospital name");
                                        return false;
                                }


                                let nameExpr = /^[a-zA-Z ]+$/.test(hospital);
                                if (!nameExpr) {
                                        messageDisplay("Please enter valid hospital name", 1500,
                                                "error");
                                        $("#hospital").focus();
                                        return false;
                                }

                                if (!hospital.match('^[a-zA-Z ]{0,1000}$')) {
                                        messageDisplay("Please enter valid name");
                                        $("#hospital").focus();
                                        return false;
                                }

                                if (hospital.length < 3 || hospital.length > 15) {
                                        messageDisplay(
                                                "name should contain 3 to 15 characters"
                                        );
                                        $("#hospital").focus();
                                        return false;
                                }
                            

                                let districtElement = $("#district");
                                let district = districtElement.val();
                                district = $.trim(district);
                                if (district == "" || district == null || district == undefined) {
                                        messageDisplay("Please Enter district name");
                                        return false;
                                }

                                let addressElement = $("#address");
                                let address = addressElement.val();   
                                 
                                address = $.trim(address);
                                if (address == "" || address == null || address == undefined) {
                                        messageDisplay("Please Enter address name");
                                        return false;
                                }


                        if (!addressExpr.test(address)) {
                            messageDisplay("Please enter valid hospital address", 1500, "error");
                            $("#address").focus();
                           return false;
                        }

                                let billerNameElement = $("#biller_name");
                                let billerName = billerNameElement.val();
                                billerName = $.trim(billerName);
                                if (billerName == "" || billerName == null || billerName == undefined) {
                                        messageDisplay("Please Enter biller name");
                                        return false;
                                }

                                let nameExprr = /^[a-zA-Z ]+$/.test(billerName);
                                if (!nameExprr) {
                                        messageDisplay("Please enter valid biller name", 1500,
                                                "error");
                                        $("#biller_name").focus();
                                        return false;
                                }

                                if (!billerName.match('^[a-zA-Z ]{0,1000}$')) {
                                        messageDisplay("Please enter valid name");
                                        $("#biller_name").focus();
                                        return false;
                                }

                                if (billerName.length < 3 || billerName.length > 15) {
                                        messageDisplay(
                                                "name should contain 3 to 15 characters"
                                        );
                                        $("#biller_name").focus();
                                        return false;
                                }

                                let emailIdElement = $("#email_id");
                                let emailId = emailIdElement.val();
                                emailId = $.trim(emailId);
                                
                                if (emailId == "" || emailId == null || emailId == undefined) {
                                        messageDisplay("Please Enter emailId ");
                                        return false;
                                }

                                if (!emailExpr.test(emailId)) {
                         messageDisplay("Please enter valid email address", 1500, "error");
                         $("#email_id").focus();
                          return false;
                        }
                                let contactNumberElement = $("#contact_number");
                                let contactNumber = contactNumberElement.val();
                                contactNumber = $.trim(contactNumber);
                                if (contactNumber == "" || contactNumber == null || contactNumber == undefined) {
                                        messageDisplay("Please Enter contact Number ");
                                        return false;
                                }


                        if (!mobileExpr.test(contactNumber)) {
                         messageDisplay("Please enter valid mobile number", 1500, "error");
                         $("#contact_number").focus();
                          return false;
                        }



                                let element = $(this);
                                element.attr("disabled", "disabled").html("Please Wait..");

                                let formData = new FormData();

                                formData.append("hospital", hospital);
                                formData.append("district", district);
                                formData.append("address", address);
                                formData.append("billerName", billerName);
                                formData.append("emailId", emailId);
                                formData.append("contactNumber", contactNumber);

                                formData.append('upload_file', mediaFiles[0]);
                                console.log(formData);


                                $.ajax({
                                        type: "POST",
                                        url: window.location.href,
                                        data: formData,
                                        dataType: "json",
                                        cache: false,
                                        contentType: false,
                                        processData: false,
                                        success: function (data) {
                                                console.log(data);
                                                if (data.success ==
                                                        true) {
                                                        messageDisplay(data
                                                                .message,
                                                                2000,
                                                                "success"
                                                        );
                                                        setTimeout(function () {
                                                                location.href =
                                                                        "/admin/hospital";
                                                        },
                                                                2000
                                                        );
                                                } else {
                                                        element.attr("disabled",
                                                                false
                                                        )
                                                                .html(
                                                                        'save'
                                                                );
                                                        messageDisplay(data
                                                                .message,
                                                                2000
                                                        );
                                                }
                                        },
                                        error: function () {
                                                messageDisplay(
                                                        "error! "
                                                );
                                        }
                                });



                        }).on('change', '#file-upload', function (e) {
                                $("#files-wrapper").removeClass("d-none");

                                var files = e.target.files;
                                var element = $(this);
                                var incerement = 0;

                                if ($(this).get(0).files.length != 0) {
                                        $.each(files, function (i, file) {
                                                console.log(files[i].type);

                                                var FileType = files[i].type;
                                                var filename = files[i].name;
                                                console.log(filename);
                                                var reader = new FileReader();
                                                reader.onload = function (e) {

                                                        var fileExtension =
                                                                FileType
                                                                        .substr((FileType
                                                                                .lastIndexOf(
                                                                                        '/'
                                                                                ) +
                                                                                1
                                                                        ));
                                                        //alert(fileExtension);return false;
                                                        var Extension =
                                                                fileExtension
                                                                        .toLowerCase();
                                                        let showFileName =
                                                                '';
                                                        let filePath =
                                                                '/static/img/file.png';
                                                        if ($.inArray(Extension,
                                                                mediaFilesacceptedExtensions
                                                        ) ===
                                                                -1) {
                                                                messageDisplay
                                                                        (
                                                                                "Not a valid file"
                                                                        );
                                                                return false;
                                                        } else {
                                                                filePath =
                                                                        e
                                                                                .target
                                                                                .result;
                                                        }
                                                        incerement++;

                                                        mediaFiles = [];
                                                        mediaFiles.push(
                                                                file
                                                        );

                                                        let html = `<div class="attachimage-box" style="background: url(${filePath}) no-repeat center;">
        <div class="delete-file delete-image">
                <i class="fas fa-trash-alt"></i>
                <div>
                        Delete
                </div>
        </div>
        <div>${showFileName}</div>
</div>`;
                                                        $("#files-wrapper")
                                                                .html(
                                                                        html
                                                                );

                                                        if (files
                                                                .length ==
                                                                incerement
                                                        ) {
                                                                element.val(
                                                                        ""
                                                                );
                                                        }
                                                };
                                                reader.readAsDataURL(file);
                                        });
                                }

                        }).on('click', '.delete-image', function (e) {
                                mediaFiles = "";
                                $("#files-wrapper").addClass("d-none");
                                // $("#files-wrapper").remove().val("");
                        });
                })
        </script>